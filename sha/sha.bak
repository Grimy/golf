#!perl

sub'f { $_ ** "@_" * ($; = 1<<32) |0}
sub'r { "@_" >> ($n = pop) | $_[@_<2] << 32-$n }
sub'h { &r ^ &r ^ &r }
#sub'h { $z = shift; $r=0; $r ^= $z >> $_ | $z*!/^3|0/ << 32-$_ for @_; $r }
#sub'h { eval ' ("@_" >> ($n = pop@_) | $_[@_<2] << 32-$n) ^'x3 .0 }
sub'a($) { $;[pop] }

vec($_=<>.v128, ($/=y===c*8-8) / 64 + 1 | 7, @; = @h = map { f.5 } @p = grep { (1x$_) !~ /^(11+)\1+$/ } 2..311) = $/ = 0;

s:.{64}:
    @w = unpack $a='N*', $&;
    $w[@w] = ($w[-7] + $w[-16] + h($w[-15],3,18,7) + h $w[-2],10,19,17) % $;,
    $;[3] += $t = f(1/3) + $w[-17] + a(7) + (a+4 & a+5 ^ ~a+4 & a+6) + h(a+4,0,25,11,6),
    @; = map $_ % $;, $t + (&a & a+1 ^ &a & a+2 ^ a+1 & a+2) + h(&a,0,22,13,2), @; for @p;
$_ = ($h[$a++]+=$_) %= $; for @;
:seg;
printf '%08x'x8, @h
