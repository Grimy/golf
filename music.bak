map{$.++;@_["@-"/4].=chr-$.%7+65while/[^$:]/g}<>;print chop,/.$/&&'/'.2**"@-",$"for@_

#!perl -pl40
@_["@-"/4].=(A..G)[9-$.]while/[^$:]/g}for(@_){$_=chop.(/.$/&&'/'.2**"@-")

#!perl -p0
$\.=(A..G)[/^o/m,8-"@-"/y///c*12].(/
\|/&&'/'.2**(()=/
.\\|$/g)).$",s/^....//gmwhile//}{

print+(A..G)[/^o/m*8-"@-"/y///c*12],/
\|/&&'/'.2**(()=/
.\\|$/g),$"while???$_=join'',<>:s/^....//gm
